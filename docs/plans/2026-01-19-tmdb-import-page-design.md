# TMDB 专用导入页设计

## 概述

新建专用的 TMDB 导入页面，采用分步式流程，优化用户体验，解决当前搜索逻辑混乱的问题。

**日期**: 2026-01-19
**状态**: 设计完成，待实现

## 设计目标

1. **简化搜索流程**：从混合搜索改为类型先行 + TMDB ID 精确导入
2. **清晰的步骤引导**：分步式界面，每步单一目标
3. **即时反馈**：输入 TMDB ID 后立即验证并显示预览

## 用户流程

```
选择类型 (电影/电视剧)
    ↓
输入 TMDB ID → 验证显示预览
    ↓
[电视剧专属] 选择季集 (整季/单集)
    ↓
确认导入 → 跳转编辑页
```

## 页面结构

### 步骤 1: 选择类型
- 两个选项卡：电影 / 电视剧
- 大按钮设计，带图标（🎬 / 📺）

### 步骤 2: 输入 TMDB ID
- 数字输入框（仅限 TMDB ID）
- 验证按钮（即时验证 ID 是否有效）
- 显示验证结果：标题、海报、年份

### 步骤 3: 电视剧专属
- 显示季度列表（Season 1, Season 2...）
- 选择"整季导入"或"单集导入"
- 单集导入：显示季数/集数输入框

### 步骤 4: 确认导入
- 显示将要导入的内容摘要
- 确认按钮 → 导入并跳转到编辑页

## API 设计

### 1. 验证 TMDB ID
```
POST /api/tmdb/validate
输入: { "tmdb_id": 123, "media_type": "movie|tv" }
输出: { "valid": true, "title": "...", "year": "...", "poster": "..." }
```

### 2. 获取季列表
```
GET /api/tmdb/tv/<tmdb_id>/seasons
输出: { "seasons": [{ "season_number": 1, "episode_count": 10, ... }] }
```

### 3. 最终导入
```
POST /api/tmdb/import/final
输入: { "tmdb_id": 123, "media_type": "movie|tv|episode", "season": 1, "episode": 5 }
输出: NFO 数据 + 跳转到 /edit
```

## UI/UX 设计

### 布局
- 居中卡片式设计，宽度约 600px
- 步骤进度条顶部显示
- 每步独立显示，切换时有过渡动画

### 交互细节
- 类型选择：大按钮，带图标
- ID 输入：实时显示"验证中..."，成功显示卡片预览
- 季集选择：卡片网格展示，Tab 键切换输入框
- 状态反馈：加载图标、错误提示、成功对勾

### 文件结构
```
web/
├── templates/
│   └── import.html          # 新建导入页
├── static/
│   └── css/
│       └── import.css       # 导入页样式
└── app.py                   # 新增路由
```

## 错误处理

| 错误类型 | 处理方式 |
|---------|---------|
| 无效 TMDB ID (404) | "未找到该 ID，请检查" |
| API 限流 (429) | "请求频繁，请稍后重试" |
| 网络错误 | "网络连接失败" |
| 季/集不存在 | "该剧没有第 X 季" / "第 X 季没有第 Y 集" |

## 输入验证

- TMDB ID：正整数
- 季数/集数：大于 0
- 空值阻止进入下一步

## 测试计划

1. **单元测试**：新增 API 端点
2. **集成测试**：完整导入流程
3. **边界测试**：无效 ID、超大季数

## 实现优先级

1. ✅ 设计完成
2. ⏳ 新建导入页面模板
3. ⏳ 实现后端 API
4. ⏳ 添加前端交互逻辑
5. ⏳ 测试与优化
